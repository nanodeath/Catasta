#!/usr/bin/env ruby

require 'optparse'

require 'term/ansicolor'
class String
  include Term::ANSIColor
end

require "catasta/core/app"

options = {
  header: true
}
input_file = nil
output_directory = nil
op = OptionParser.new do |opts|
  opts.banner = "Usage: ruby #{File.basename $0} [options] input_file output_directory/"
  opts.on("-v", "--[no-]verbose", "Run verbosely") do |v|
    options[:verbose] = v
  end
  opts.on("-t", "--targets x,y,z", Array, "Type(s) to output, e.g. Java15, Ruby.") do |t|
    options[:targets] = t
  end
  opts.on("--[no-]header", "Enable or disable the header at the top of generated files.") do |h|
    options[:header] = h
  end
  # No argument, shows at tail.  This will print an options summary.
  opts.on_tail("-h", "--help", "Show this message") do
    puts opts
    exit
  end
end
op.parse!

input_file = ARGV.shift
output_directory = ARGV.shift

if !input_file || !output_directory
  puts op.help
  exit 1
end

unless File.exist? input_file
  $stderr.puts "File not found: `#{input_file}`"
  exit
end

Catasta::App.new(options).go(File.read(input_file), output_directory)